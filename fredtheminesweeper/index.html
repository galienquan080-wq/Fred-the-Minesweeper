<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Fred the Minesweeper</title>
  <style>
    body {
      background: #111;
      color: #eee;
      font-family: Arial, sans-serif;
      display: flex;
      flex-direction: column;
      align-items: center;
      padding-top: 20px;
    }
    #board {
      display: grid;
      gap: 4px;
      margin-top: 20px;
    }
    .cell {
      width: 40px;
      height: 40px;
      background-color: #0b4f0b;
      border: 0.5px solid #062f06;
      display: flex;
      justify-content: center;
      align-items: center;
      cursor: pointer;
      color: white;
      font-weight: bold;
      user-select: none;
      transition: background-color 0.1s;
    }
    .cell-dug {
      background-color:#8b5a2b;
      border:0.5px solid #5c3c1a;
    }
    .cell-exploded {
      background-color:#000;
    }
  </style>
  <link rel="apple-touch-icon" sizes="180x180" href="favicon-180.png">
  <link rel="icon" sizes="180x180" href="favicon-180.png">
</head>
<body>

  <!-- Language Box -->
  <div id="langBox" style="position:fixed; left:10px; top:20px; background:#222; padding:10px 15px; border:1px solid #444; border-radius:6px;">
    <label><input type="radio" name="lang" value="vi"> Tiáº¿ng Viá»‡t</label><br>
    <label><input type="radio" name="lang" value="en" checked> English</label>
  </div>

  <h1 id="title">Fred the Minesweeper</h1>

  <div id="board"></div>

  <div id="tools" style="position: fixed; right: 20px; top: 100px; color:#ccc; font-size:16px; background:#222; padding:15px; border-radius:10px; border:1px solid #444;">
    <b id="digTitle">Dig Mode:</b><br>
    <label><input type="radio" name="digmode" value="1" checked> 1Ã—1</label><br>
    <label><input type="radio" name="digmode" value="3"> 3Ã—3</label><br>
    <label><input type="radio" name="digmode" value="5"> 5Ã—5</label><br>
  </div>

  <div id="status" style="margin-top:20px; color:#ccc; font-size:16px;">Day: 1 | Findings: none</div>

<script>
  let day = 1;
  let findings = [];
  let switchCount = 0;
  const size = Math.floor(Math.random() * 11) + 10;
  const board = [];

  function chooseElement() {
    return Math.random() < 0.07 ? "switch" : (Math.random() < 0.12 ? "mine" : "empty");
  }

  function setupBoard() {
    const boardDiv = document.getElementById("board");
    boardDiv.style.gridTemplateColumns = `repeat(${size}, 32px)`;
    boardDiv.style.gridTemplateRows = `repeat(${size}, 32px)`;

    let spawnedSwitch = false;

    for (let y = 0; y < size; y++) {
      board[y] = [];
      for (let x = 0; x < size; x++) {
        let element = chooseElement();
        if (element === "switch") {
          if (spawnedSwitch) element = "empty";
          else spawnedSwitch = true;
        }

        const cell = { x, y, element, revealed: false, _div: null };
        board[y][x] = cell;

        const div = document.createElement("div");
        div.classList.add("cell");
        div.onclick = () => reveal(cell, div);
        cell._div = div;
        boardDiv.appendChild(div);
      }
    }
  }

  function countMines(x, y) {
    let c = 0;
    for (let dy = -1; dy <= 1; dy++) {
      for (let dx = -1; dx <= 1; dx++) {
        if (dx || dy) {
          const nx = x + dx, ny = y + dy;
          if (board[ny] && board[ny][nx] && board[ny][nx].element === "mine") c++;
        }
      }
    }
    return c;
  }

  function reveal(cell, div) {
    const mode = parseInt(document.querySelector('input[name="digmode"]:checked').value);
    if (mode !== 1) return digArea(cell.x, cell.y, mode);

    if (cell.revealed) return;
    cell.revealed = true;
    div.classList.add("cell-dug");

    if (cell.element === "mine") {
      div.classList.add("cell-exploded");
      div.textContent = "ðŸ’¥";
      alert(getText("mineHit"));
      location.reload();
      return;
    }

    if (cell.element === "switch") {
      div.textContent = "ðŸ”§";
      let g = confirm(getText("toggleSwitch"));
      if (g) {
        switchCount++;
        if (switchCount === 666) alert(getText("evilEvent"));
      }
    } else {
      let m = countMines(cell.x, cell.y);
      div.textContent = m === 0 ? "" : m;
    }

    updateStatus();
  }

  function digArea(cx, cy, mode) {
    let r = mode === 3 ? 1 : (mode === 5 ? 2 : 0);
    for (let y = cy - r; y <= cy + r; y++) {
      for (let x = cx - r; x <= cx + r; x++) {
        if (board[y] && board[y][x]) {
          const c = board[y][x];
          if (!c.revealed) {
            c.revealed = true;
            c._div.classList.add("cell-dug");

            if (c.element === "mine") {
              c._div.classList.add("cell-exploded");
              c._div.textContent = "ðŸ’¥";
              alert(getText("mineHit"));
              location.reload();
              return;
            }

            if (c.element === "switch") {
              c._div.textContent = "ðŸ”§";
              let g = confirm(getText("toggleSwitch"));
              if (g) {
                switchCount++;
                if (switchCount === 666) alert(getText("evilEvent"));
              }
            } else {
              let m = countMines(c.x, c.y);
              c._div.textContent = m === 0 ? "" : m;
            }
          }
        }
      }
    }
    updateStatus();
  }

  function updateStatus() {
    const L = getLang();
    const txt = L === 'vi'
      ? `NgÃ y: ${day} | PhÃ¡t hiá»‡n: ${findings.length ? findings.join(', ') : 'khÃ´ng cÃ³'}`
      : `Day: ${day} | Findings: ${findings.length ? findings.join(', ') : 'none'}`;
    document.getElementById("status").textContent = txt;
  }

  function getLang() {
    return document.querySelector('input[name="lang"]:checked').value;
  }

  const UItext = {
    title: { vi: "Fred thá»£ Ä‘Ã o mÃ¬n", en: "Fred the Minesweeper" },
    digTitle: { vi: "Cháº¿ Ä‘á»™ Ä‘Ã o:", en: "Dig Mode:" }
  };

  function updateLanguageUI() {
    const L = getLang();
    document.getElementById("title").textContent = UItext.title[L];
    document.getElementById("digTitle").textContent = UItext.digTitle[L];
    updateStatus();
  }

  document.addEventListener("DOMContentLoaded", () => {
    setupBoard();
    document.querySelectorAll('input[name="lang"]').forEach(r =>
      r.addEventListener("change", updateLanguageUI)
    );
  });
</script>

</body>
</html>
